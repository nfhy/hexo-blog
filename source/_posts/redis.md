title: redis缓存实现
date: 2019-01-06 11:53:35
---
## 设计要求

系统数据字典类数据属于读远大于写的业务数据，在业务层和数据层之间插入缓存层可以极大提高读取速度。但需要解决如下问题：
1. 数据同步，数据新增/删除/修改时同步缓存数据
2. 缓存穿透/击穿/雪崩问题避免
3. 编码方式足够简单，现有redis客户端仅对redis命令进行封装，更上层的封装仍需要自己实现

## 前期设计思路

> 前期设计思路，实际编码与思路有差异

![redis脑图](/images/posts/redis-mindx.png)

## 实际实现思路

1. 缓存穿透：bloomFilter + 黑名单
2. 缓存击穿/缓存雪崩：随机TTL或永不过期（数据字典数据量小，不存在内存不足问题）
2. 数据字典类型数据：根据数据字典数据结构特点，使用 key:redisHash:\<dataKey:data\> 方式组织数据
3. 新增数据：更新bloomFilter，更新黑名单，插入redis
4. 删除数据：更新bloomFilter，更新黑名单，删除redis
5. 更新数据：更新redis，更新db
6. 查询数据：
    1. bloomFilter过滤
    2. 黑名单过滤
    3. 缓存查找
        1. 缓存命中：返回数据
        2. 缓存未命中：查询db
            1. db查询到数据时，新增数据逻辑
            2. db未查询到数据时，删除数据逻辑
7. 数据序列化：Kryo protoBuff等速度快，但使用不便，需要注册java对象类型，改用jackson2
